# Minimal c-icap config for AV experimentation.
# NOTE: Exact module/service names depend on the built c-icap-modules set.
# We'll start with a conservative config and adjust after verifying the installed .so names.

ServerName squid-flask-proxy-cicap
PidFile /var/run/c-icap/c-icap.pid

# Use a port that does NOT conflict with the Python ICAP worker ports (1344+).
Port 14000

# Paths (defaults for source installs; included for clarity)
ModulesDir /usr/lib/c_icap
ServicesDir /usr/lib/c_icap
TemplateDir /usr/share/c_icap/templates

# Logging to stdout/stderr via supervisord
DebugLevel 1

# Service mapping:
# We intentionally name it "avrespmod" to match the Squid ICAP URL path.
# Use the c-icap-modules virus_scan service, and alias it to match Squid's ICAP URL path.
Service virus_scan virus_scan.so
ServiceAlias avrespmod virus_scan?allow204=on&sizelimit=off&mode=simple

# Module/service configuration (provided by this repo)
Include clamd_mod.conf
Include virus_scan.conf
